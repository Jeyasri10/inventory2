import streamlit as st
import pandas as pd
import time

# Streamlit User Interface
st.title("Retail Store Demand Prediction")

# Input fields for user data
price = st.number_input("Price ($)", min_value=0.0, value=10.0)
discount = st.number_input("Discount (%)", min_value=0.0, max_value=100.0, value=10.0)
demand_forecast = st.number_input("Demand Forecast (Units)", min_value=0, value=100)
competitor_pricing = st.number_input("Competitor Pricing ($)", min_value=0.0, value=10.0)
inventory_level = st.number_input("Inventory Level", min_value=0, value=100)
units_ordered = st.number_input("Units Ordered", min_value=0, value=50)

# Calculate discounted price
discounted_price = price * (1 - discount / 100)

# HTML content generation based on user input
if st.button("Generate HTML Report"):
    # Dynamic filename based on user input and current timestamp
    timestamp = time.strftime("%Y%m%d-%H%M%S")
    html_filename = f"demand_prediction_report_{timestamp}.html"
    
    # Create HTML content
    html_content = f"""
    <html>
    <head>
        <title>Demand Prediction Report</title>
        <style>
            body {{
                font-family: Arial, sans-serif;
                margin: 20px;
                padding: 20px;
                background-color: #f4f4f4;
            }}
            .container {{
                width: 60%;
                margin: 0 auto;
                background-color: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }}
            h1 {{
                text-align: center;
                color: #333;
            }}
            p {{
                font-size: 16px;
                line-height: 1.6;
            }}
            .result {{
                background-color: #e0f7fa;
                padding: 10px;
                border-radius: 5px;
                margin-top: 10px;
            }}
        </style>
    </head>
    <body>
        <div class="container">
            <h1>Retail Store Demand Prediction Report</h1>
            <p><strong>Price ($):</strong> {price}</p>
            <p><strong>Discount (%):</strong> {discount}</p>
            <p><strong>Demand Forecast (Units):</strong> {demand_forecast}</p>
            <p><strong>Competitor Pricing ($):</strong> {competitor_pricing}</p>
            <p><strong>Inventory Level:</strong> {inventory_level}</p>
            <p><strong>Units Ordered:</strong> {units_ordered}</p>
            <div class="result">
                <h3>Calculated Results</h3>
                <p><strong>Discounted Price ($):</strong> {discounted_price:.2f}</p>
            </div>
        </div>
    </body>
    </html>
    """

    # Save HTML content to a file
    with open(html_filename, "w") as file:
        file.write(html_content)
    
    # Provide a download link for the generated HTML file
    with open(html_filename, "r") as file:
        st.download_button(
            label="Download HTML Report",
            data=file,
            file_name=html_filename,  # Dynamically set the file name
            mime="text/html"
        )
